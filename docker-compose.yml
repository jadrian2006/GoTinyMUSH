services:
  gotinymush:
    build:
      context: .
      args:
        VERSION: "0.3.0"
    ports:
      - "6250:6250"
      - "8443:8443"
      # - "6251:6251"  # TLS port
    volumes:
      - gamedata:/game/data
    environment:
      # --- User/Group mapping (match your host user) ---
      PUID: 1000
      PGID: 1000
      TZ: America/New_York
      # --- Game config ---
      MUSH_CONF: /game/data/game.yaml
      # MUSH_BOLT and MUSH_DB intentionally omitted for setup mode.
      # The server starts in admin-panel-only mode until setup/import is complete.
      # MUSH_BOLT: /game/data/game.bolt
      # MUSH_DB: /game/data/game.flatfile
      MUSH_TEXTDIR: /game/data/text
      MUSH_DICTDIR: /game/data/dict
      MUSH_GODPASS: "goTinyMush"
      MUSH_ADMIN_PASS: "goTinyMush"
      # MUSH_PORT: 6250
      # MUSH_TLS: "true"
      # MUSH_TLS_PORT: "6251"
      # MUSH_TLS_CERT: /game/data/cert.pem
      # MUSH_TLS_KEY: /game/data/key.pem
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8443/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  gamedata:

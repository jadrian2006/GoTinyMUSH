(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var ie,T,je,z,ge,Re,Ne,He,me,ce,de,Q={},Ge=[],at=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ae=Array.isArray;function G(t,s){for(var n in s)t[n]=s[n];return t}function fe(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function ot(t,s,n){var l,i,r,a={};for(r in s)r=="key"?l=s[r]:r=="ref"?i=s[r]:a[r]=s[r];if(arguments.length>2&&(a.children=arguments.length>3?ie.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(r in t.defaultProps)a[r]===void 0&&(a[r]=t.defaultProps[r]);return ee(t,a,l,i,null)}function ee(t,s,n,l,i){var r={type:t,props:s,key:n,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++je,__i:-1,__u:0};return i==null&&T.vnode!=null&&T.vnode(r),r}function N(t){return t.children}function te(t,s){this.props=t,this.context=s}function B(t,s){if(s==null)return t.__?B(t.__,t.__i+1):null;for(var n;s<t.__k.length;s++)if((n=t.__k[s])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?B(t):null}function We(t){var s,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,s=0;s<t.__k.length;s++)if((n=t.__k[s])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return We(t)}}function be(t){(!t.__d&&(t.__d=!0)&&z.push(t)&&!re.__r++||ge!=T.debounceRendering)&&((ge=T.debounceRendering)||Re)(re)}function re(){for(var t,s,n,l,i,r,a,c=1;z.length;)z.length>c&&z.sort(Ne),t=z.shift(),c=z.length,t.__d&&(n=void 0,l=void 0,i=(l=(s=t).__v).__e,r=[],a=[],s.__P&&((n=G({},l)).__v=l.__v+1,T.vnode&&T.vnode(n),_e(s.__P,n,l,s.__n,s.__P.namespaceURI,32&l.__u?[i]:null,r,i??B(l),!!(32&l.__u),a),n.__v=l.__v,n.__.__k[n.__i]=n,qe(r,n,a),l.__e=l.__=null,n.__e!=i&&We(n)));re.__r=0}function ze(t,s,n,l,i,r,a,c,h,d,p){var o,m,u,_,C,S,b,w=l&&l.__k||Ge,D=s.length;for(h=ct(n,s,w,h,D),o=0;o<D;o++)(u=n.__k[o])!=null&&(m=u.__i==-1?Q:w[u.__i]||Q,u.__i=o,S=_e(t,u,m,i,r,a,c,h,d,p),_=u.__e,u.ref&&m.ref!=u.ref&&(m.ref&&xe(m.ref,null,u),p.push(u.ref,u.__c||_,u)),C==null&&_!=null&&(C=_),(b=!!(4&u.__u))||m.__k===u.__k?h=Be(u,h,t,b):typeof u.type=="function"&&S!==void 0?h=S:_&&(h=_.nextSibling),u.__u&=-7);return n.__e=C,h}function ct(t,s,n,l,i){var r,a,c,h,d,p=n.length,o=p,m=0;for(t.__k=new Array(i),r=0;r<i;r++)(a=s[r])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=t.__k[r]=ee(null,a,null,null,null):ae(a)?a=t.__k[r]=ee(N,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=t.__k[r]=ee(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):t.__k[r]=a,h=r+m,a.__=t,a.__b=t.__b+1,c=null,(d=a.__i=dt(a,n,h,o))!=-1&&(o--,(c=n[d])&&(c.__u|=2)),c==null||c.__v==null?(d==-1&&(i>p?m--:i<p&&m++),typeof a.type!="function"&&(a.__u|=4)):d!=h&&(d==h-1?m--:d==h+1?m++:(d>h?m--:m++,a.__u|=4))):t.__k[r]=null;if(o)for(r=0;r<p;r++)(c=n[r])!=null&&(2&c.__u)==0&&(c.__e==l&&(l=B(c)),Ve(c,c));return l}function Be(t,s,n,l){var i,r;if(typeof t.type=="function"){for(i=t.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=t,s=Be(i[r],s,n,l));return s}t.__e!=s&&(l&&(s&&t.type&&!s.parentNode&&(s=B(t)),n.insertBefore(t.__e,s||null)),s=t.__e);do s=s&&s.nextSibling;while(s!=null&&s.nodeType==8);return s}function dt(t,s,n,l){var i,r,a,c=t.key,h=t.type,d=s[n],p=d!=null&&(2&d.__u)==0;if(d===null&&c==null||p&&c==d.key&&h==d.type)return n;if(l>(p?1:0)){for(i=n-1,r=n+1;i>=0||r<s.length;)if((d=s[a=i>=0?i--:r++])!=null&&(2&d.__u)==0&&c==d.key&&h==d.type)return a}return-1}function ve(t,s,n){s[0]=="-"?t.setProperty(s,n??""):t[s]=n==null?"":typeof n!="number"||at.test(s)?n:n+"px"}function Z(t,s,n,l,i){var r,a;e:if(s=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof l=="string"&&(t.style.cssText=l=""),l)for(s in l)n&&s in n||ve(t.style,s,"");if(n)for(s in n)l&&n[s]==l[s]||ve(t.style,s,n[s])}else if(s[0]=="o"&&s[1]=="n")r=s!=(s=s.replace(He,"$1")),a=s.toLowerCase(),s=a in t||s=="onFocusOut"||s=="onFocusIn"?a.slice(2):s.slice(2),t.l||(t.l={}),t.l[s+r]=n,n?l?n.u=l.u:(n.u=me,t.addEventListener(s,r?de:ce,r)):t.removeEventListener(s,r?de:ce,r);else{if(i=="http://www.w3.org/2000/svg")s=s.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(s!="width"&&s!="height"&&s!="href"&&s!="list"&&s!="form"&&s!="tabIndex"&&s!="download"&&s!="rowSpan"&&s!="colSpan"&&s!="role"&&s!="popover"&&s in t)try{t[s]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&s[4]!="-"?t.removeAttribute(s):t.setAttribute(s,s=="popover"&&n==1?"":n))}}function ye(t){return function(s){if(this.l){var n=this.l[s.type+t];if(s.t==null)s.t=me++;else if(s.t<n.u)return;return n(T.event?T.event(s):s)}}}function _e(t,s,n,l,i,r,a,c,h,d){var p,o,m,u,_,C,S,b,w,D,v,L,P,M,$,U,E,O=s.type;if(s.constructor!==void 0)return null;128&n.__u&&(h=!!(32&n.__u),r=[c=s.__e=n.__e]),(p=T.__b)&&p(s);e:if(typeof O=="function")try{if(b=s.props,w="prototype"in O&&O.prototype.render,D=(p=O.contextType)&&l[p.__c],v=p?D?D.props.value:p.__:l,n.__c?S=(o=s.__c=n.__c).__=o.__E:(w?s.__c=o=new O(b,v):(s.__c=o=new te(b,v),o.constructor=O,o.render=ut),D&&D.sub(o),o.state||(o.state={}),o.__n=l,m=o.__d=!0,o.__h=[],o._sb=[]),w&&o.__s==null&&(o.__s=o.state),w&&O.getDerivedStateFromProps!=null&&(o.__s==o.state&&(o.__s=G({},o.__s)),G(o.__s,O.getDerivedStateFromProps(b,o.__s))),u=o.props,_=o.state,o.__v=s,m)w&&O.getDerivedStateFromProps==null&&o.componentWillMount!=null&&o.componentWillMount(),w&&o.componentDidMount!=null&&o.__h.push(o.componentDidMount);else{if(w&&O.getDerivedStateFromProps==null&&b!==u&&o.componentWillReceiveProps!=null&&o.componentWillReceiveProps(b,v),s.__v==n.__v||!o.__e&&o.shouldComponentUpdate!=null&&o.shouldComponentUpdate(b,o.__s,v)===!1){for(s.__v!=n.__v&&(o.props=b,o.state=o.__s,o.__d=!1),s.__e=n.__e,s.__k=n.__k,s.__k.some(function(W){W&&(W.__=s)}),L=0;L<o._sb.length;L++)o.__h.push(o._sb[L]);o._sb=[],o.__h.length&&a.push(o);break e}o.componentWillUpdate!=null&&o.componentWillUpdate(b,o.__s,v),w&&o.componentDidUpdate!=null&&o.__h.push(function(){o.componentDidUpdate(u,_,C)})}if(o.context=v,o.props=b,o.__P=t,o.__e=!1,P=T.__r,M=0,w){for(o.state=o.__s,o.__d=!1,P&&P(s),p=o.render(o.props,o.state,o.context),$=0;$<o._sb.length;$++)o.__h.push(o._sb[$]);o._sb=[]}else do o.__d=!1,P&&P(s),p=o.render(o.props,o.state,o.context),o.state=o.__s;while(o.__d&&++M<25);o.state=o.__s,o.getChildContext!=null&&(l=G(G({},l),o.getChildContext())),w&&!m&&o.getSnapshotBeforeUpdate!=null&&(C=o.getSnapshotBeforeUpdate(u,_)),U=p,p!=null&&p.type===N&&p.key==null&&(U=Ye(p.props.children)),c=ze(t,ae(U)?U:[U],s,n,l,i,r,a,c,h,d),o.base=s.__e,s.__u&=-161,o.__h.length&&a.push(o),S&&(o.__E=o.__=null)}catch(W){if(s.__v=null,h||r!=null)if(W.then){for(s.__u|=h?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;r[r.indexOf(c)]=null,s.__e=c}else{for(E=r.length;E--;)fe(r[E]);he(s)}else s.__e=n.__e,s.__k=n.__k,W.then||he(s);T.__e(W,s,n)}else r==null&&s.__v==n.__v?(s.__k=n.__k,s.__e=n.__e):c=s.__e=ht(n.__e,s,n,l,i,r,a,h,d);return(p=T.diffed)&&p(s),128&s.__u?void 0:c}function he(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(he)}function qe(t,s,n){for(var l=0;l<n.length;l++)xe(n[l],n[++l],n[++l]);T.__c&&T.__c(s,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(r){r.call(i)})}catch(r){T.__e(r,i.__v)}})}function Ye(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ae(t)?t.map(Ye):G({},t)}function ht(t,s,n,l,i,r,a,c,h){var d,p,o,m,u,_,C,S=n.props||Q,b=s.props,w=s.type;if(w=="svg"?i="http://www.w3.org/2000/svg":w=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(d=0;d<r.length;d++)if((u=r[d])&&"setAttribute"in u==!!w&&(w?u.localName==w:u.nodeType==3)){t=u,r[d]=null;break}}if(t==null){if(w==null)return document.createTextNode(b);t=document.createElementNS(i,w,b.is&&b),c&&(T.__m&&T.__m(s,r),c=!1),r=null}if(w==null)S===b||c&&t.data==b||(t.data=b);else{if(r=r&&ie.call(t.childNodes),!c&&r!=null)for(S={},d=0;d<t.attributes.length;d++)S[(u=t.attributes[d]).name]=u.value;for(d in S)if(u=S[d],d!="children"){if(d=="dangerouslySetInnerHTML")o=u;else if(!(d in b)){if(d=="value"&&"defaultValue"in b||d=="checked"&&"defaultChecked"in b)continue;Z(t,d,null,u,i)}}for(d in b)u=b[d],d=="children"?m=u:d=="dangerouslySetInnerHTML"?p=u:d=="value"?_=u:d=="checked"?C=u:c&&typeof u!="function"||S[d]===u||Z(t,d,u,S[d],i);if(p)c||o&&(p.__html==o.__html||p.__html==t.innerHTML)||(t.innerHTML=p.__html),s.__k=[];else if(o&&(t.innerHTML=""),ze(s.type=="template"?t.content:t,ae(m)?m:[m],s,n,l,w=="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,a,r?r[0]:n.__k&&B(n,0),c,h),r!=null)for(d=r.length;d--;)fe(r[d]);c||(d="value",w=="progress"&&_==null?t.removeAttribute("value"):_!=null&&(_!==t[d]||w=="progress"&&!_||w=="option"&&_!=S[d])&&Z(t,d,_,S[d],i),d="checked",C!=null&&C!=t[d]&&Z(t,d,C,S[d],i))}return t}function xe(t,s,n){try{if(typeof t=="function"){var l=typeof t.__u=="function";l&&t.__u(),l&&s==null||(t.__u=t(s))}else t.current=s}catch(i){T.__e(i,n)}}function Ve(t,s,n){var l,i;if(T.unmount&&T.unmount(t),(l=t.ref)&&(l.current&&l.current!=t.__e||xe(l,null,s)),(l=t.__c)!=null){if(l.componentWillUnmount)try{l.componentWillUnmount()}catch(r){T.__e(r,s)}l.base=l.__P=null}if(l=t.__k)for(i=0;i<l.length;i++)l[i]&&Ve(l[i],s,n||typeof t.type!="function");n||fe(t.__e),t.__c=t.__=t.__e=void 0}function ut(t,s,n){return this.constructor(t,n)}function pt(t,s,n){var l,i,r,a;s==document&&(s=document.documentElement),T.__&&T.__(t,s),i=(l=!1)?null:s.__k,r=[],a=[],_e(s,t=s.__k=ot(N,null,[t]),i||Q,Q,s.namespaceURI,i?null:s.firstChild?ie.call(s.childNodes):null,r,i?i.__e:s.firstChild,l,a),qe(r,t,a)}ie=Ge.slice,T={__e:function(t,s,n,l){for(var i,r,a;s=s.__;)if((i=s.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(t)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,l||{}),a=i.__d),a)return i.__E=i}catch(c){t=c}throw t}},je=0,te.prototype.setState=function(t,s){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=G({},this.state),typeof t=="function"&&(t=t(G({},n),this.props)),t&&G(n,t),t!=null&&this.__v&&(s&&this._sb.push(s),be(this))},te.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),be(this))},te.prototype.render=N,z=[],Re=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ne=function(t,s){return t.__v.__b-s.__v.__b},re.__r=0,He=/(PointerCapture)$|Capture$/i,me=0,ce=ye(!1),de=ye(!0);var mt=0;function e(t,s,n,l,i,r){s||(s={});var a,c,h=s;if("ref"in h)for(c in h={},s)c=="ref"?a=s[c]:h[c]=s[c];var d={type:t,props:h,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--mt,__i:-1,__u:0,__source:i,__self:r};if(typeof t=="function"&&(a=t.defaultProps))for(c in a)h[c]===void 0&&(h[c]=a[c]);return T.vnode&&T.vnode(d),d}var le,F,oe,we,ue=0,Qe=[],A=T,Se=A.__b,Ce=A.__r,ke=A.diffed,Te=A.__c,Pe=A.unmount,Le=A.__;function Ke(t,s){A.__h&&A.__h(F,t,ue||s),ue=0;var n=F.__H||(F.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function f(t){return ue=1,ft(Je,t)}function ft(t,s,n){var l=Ke(le++,2);if(l.t=t,!l.__c&&(l.__=[Je(void 0,s),function(c){var h=l.__N?l.__N[0]:l.__[0],d=l.t(h,c);h!==d&&(l.__N=[d,l.__[1]],l.__c.setState({}))}],l.__c=F,!F.__f)){var i=function(c,h,d){if(!l.__c.__H)return!0;var p=l.__c.__H.__.filter(function(m){return!!m.__c});if(p.every(function(m){return!m.__N}))return!r||r.call(this,c,h,d);var o=l.__c.props!==c;return p.forEach(function(m){if(m.__N){var u=m.__[0];m.__=m.__N,m.__N=void 0,u!==m.__[0]&&(o=!0)}}),r&&r.call(this,c,h,d)||o};F.__f=!0;var r=F.shouldComponentUpdate,a=F.componentWillUpdate;F.componentWillUpdate=function(c,h,d){if(this.__e){var p=r;r=void 0,i(c,h,d),r=p}a&&a.call(this,c,h,d)},F.shouldComponentUpdate=i}return l.__N||l.__}function q(t,s){var n=Ke(le++,3);!A.__s&&gt(n.__H,s)&&(n.__=t,n.u=s,F.__H.__h.push(n))}function _t(){for(var t;t=Qe.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(se),t.__H.__h.forEach(pe),t.__H.__h=[]}catch(s){t.__H.__h=[],A.__e(s,t.__v)}}A.__b=function(t){F=null,Se&&Se(t)},A.__=function(t,s){t&&s.__k&&s.__k.__m&&(t.__m=s.__k.__m),Le&&Le(t,s)},A.__r=function(t){Ce&&Ce(t),le=0;var s=(F=t.__c).__H;s&&(oe===F?(s.__h=[],F.__h=[],s.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(s.__h.forEach(se),s.__h.forEach(pe),s.__h=[],le=0)),oe=F},A.diffed=function(t){ke&&ke(t);var s=t.__c;s&&s.__H&&(s.__H.__h.length&&(Qe.push(s)!==1&&we===A.requestAnimationFrame||((we=A.requestAnimationFrame)||xt)(_t)),s.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),oe=F=null},A.__c=function(t,s){s.some(function(n){try{n.__h.forEach(se),n.__h=n.__h.filter(function(l){return!l.__||pe(l)})}catch(l){s.some(function(i){i.__h&&(i.__h=[])}),s=[],A.__e(l,n.__v)}}),Te&&Te(t,s)},A.unmount=function(t){Pe&&Pe(t);var s,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(l){try{se(l)}catch(i){s=i}}),n.__H=void 0,s&&A.__e(s,n.__v))};var Ee=typeof requestAnimationFrame=="function";function xt(t){var s,n=function(){clearTimeout(l),Ee&&cancelAnimationFrame(s),setTimeout(t)},l=setTimeout(n,35);Ee&&(s=requestAnimationFrame(n))}function se(t){var s=F,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),F=s}function pe(t){var s=F;t.__c=t.__(),F=s}function gt(t,s){return!t||t.length!==s.length||s.some(function(n,l){return n!==t[l]})}function Je(t,s){return typeof s=="function"?s(t):s}const K={appName:"GoTinyMUSH",tagline:"Modern MUSH Server"},bt=[{page:"dashboard",label:"Dashboard",icon:"⌂"},{page:"import",label:"Import",icon:"⇧"},{page:"config",label:"Config",icon:"⚙"}];function vt({currentPage:t,onNavigate:s,setupMode:n,onLogout:l,children:i}){return e("div",{class:"flex min-h-screen",children:[e("aside",{class:"w-56 bg-slate-800 border-r border-slate-700 flex flex-col",children:[e("div",{class:"p-4 border-b border-slate-700",children:[e("h1",{class:"text-lg font-bold text-indigo-400",children:K.appName}),e("p",{class:"text-xs text-slate-400",children:K.tagline})]}),e("nav",{class:"flex-1 p-2",children:bt.map(r=>e("button",{onClick:()=>s(r.page),class:`w-full text-left px-3 py-2 rounded text-sm mb-1 flex items-center gap-2 transition-colors ${t===r.page?"bg-indigo-500/20 text-indigo-300":"text-slate-300 hover:bg-slate-700"}`,children:[e("span",{children:r.icon}),r.label]},r.page))}),n&&e("div",{class:"p-3 m-2 bg-amber-500/10 border border-amber-500/30 rounded text-xs text-amber-300",children:"Setup mode active"}),l&&e("div",{class:"p-2 border-t border-slate-700",children:e("button",{onClick:l,class:"w-full text-left px-3 py-2 rounded text-sm text-slate-400 hover:bg-slate-700 hover:text-slate-300 transition-colors",children:"Logout"})})]}),e("main",{class:"flex-1 p-6 overflow-auto",children:i})]})}const Ze="/admin/api";let ne=null;function yt(t){ne=t}async function k(t,s,n){const l={method:t,headers:{"Content-Type":"application/json"}};n!==void 0&&(l.body=JSON.stringify(n));const i=await fetch(`${Ze}${s}`,l);if(!i.ok){i.status===401&&!s.startsWith("/auth/")&&(ne==null||ne());const r=await i.json().catch(()=>({error:i.statusText}));throw new Error(r.error||i.statusText)}return i.json()}const y={serverStatus:()=>k("GET","/server/status"),serverStart:()=>k("POST","/server/start"),serverStop:()=>k("POST","/server/stop"),getConfig:()=>k("GET","/config"),putConfig:t=>k("PUT","/config",t),importUpload:t=>k("POST","/import/upload",{path:t}),importUploadFile:async t=>{const s=new FormData;s.append("flatfile",t);const n=await fetch(`${Ze}/import/upload`,{method:"POST",body:s});if(!n.ok){const l=await n.json().catch(()=>({error:n.statusText}));throw new Error(l.error||n.statusText)}return n.json()},importValidate:()=>k("POST","/import/validate"),importFindings:()=>k("GET","/import/findings"),importFix:(t,s)=>k("POST","/import/fix",{finding_id:t,category:s}),importCommit:()=>k("POST","/import/commit"),importCommitProgress:()=>k("GET","/import/commit/progress"),importSession:()=>k("GET","/import/session"),importReset:()=>k("DELETE","/import/session"),importDiscover:()=>k("POST","/import/discover"),importAssign:(t,s)=>k("POST","/import/assign",{path:t,role:s}),importConvertConfig:t=>k("POST","/import/convert-config",{path:t}),importParseComsys:t=>k("POST","/import/parse-comsys",{path:t}),importGetFile:(t,s)=>k("GET",`/import/file/${encodeURIComponent(t)}/${encodeURIComponent(s)}`),importPutFile:(t,s,n)=>k("PUT",`/import/file/${encodeURIComponent(t)}/${encodeURIComponent(s)}`,{content:n}),serverShutdown:(t,s)=>k("POST","/server/shutdown",{delay:t||300,reason:s||""}),shutdownStatus:()=>k("GET","/server/shutdown"),shutdownCancel:()=>k("DELETE","/server/shutdown"),setupStatus:()=>k("GET","/setup/status"),createNewDB:()=>k("POST","/import/create-new"),serverLaunch:()=>k("POST","/server/launch"),authLogin:t=>k("POST","/auth/login",{password:t}),authLogout:()=>k("POST","/auth/logout"),authStatus:()=>k("GET","/auth/status"),authChangePassword:(t,s)=>k("POST","/auth/change-password",{current:t,new:s})};function $e(){const[t,s]=f(null),[n,l]=f(""),[i,r]=f(!0),[a,c]=f(""),[h,d]=f(null),[p,o]=f(!1),[m,u]=f(300),[_,C]=f(""),S=()=>{r(!0),y.serverStatus().then(E=>{s(E),l("")}).catch(E=>l(E.message)).finally(()=>r(!1))},b=()=>{y.shutdownStatus().then(E=>d(E)).catch(()=>{})};q(()=>{S(),b();const E=setInterval(()=>{S(),b()},2e3);return()=>clearInterval(E)},[]);const w=async()=>{c("");try{await y.serverStart(),S()}catch(E){c(E.message)}},D=async()=>{c(""),o(!1);try{await y.serverShutdown(m,_||void 0),b()}catch(E){c(E.message)}},v=async()=>{c("");try{await y.shutdownCancel(),b()}catch(E){c(E.message)}};if(i&&!t)return e("div",{class:"text-slate-400",children:"Loading..."});if(n)return e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-4 text-red-300",children:n});const L=t==null?void 0:t.setup_mode,P=window.location.hostname,M=t==null?void 0:t.connections,$=t==null?void 0:t.queue,U=t==null?void 0:t.memory;return e("div",{children:[e("h2",{class:"text-2xl font-bold mb-6",children:"Dashboard"}),e("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e(X,{label:"Server Status",value:L?"Setup Mode":t!=null&&t.running?"Running":"Stopped",color:L?"text-amber-400":t!=null&&t.running?"text-green-400":"text-red-400"}),e(X,{label:"Connected Players",value:String((t==null?void 0:t.player_count)??0),color:"text-cyan-400"}),e(X,{label:"Objects",value:String((t==null?void 0:t.object_count)??0),color:"text-indigo-400"}),e(X,{label:"Uptime",value:(t==null?void 0:t.uptime)>0?Fe(t.uptime):"-",color:"text-slate-300"})]}),(t==null?void 0:t.running)&&!L&&e("div",{class:"bg-slate-800 rounded p-3 mb-4 flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[t.game_name&&e("span",{children:[e("span",{class:"text-slate-500",children:"Name:"})," ",e("span",{class:"text-slate-200",children:t.game_name})]}),t.version&&e("span",{children:[e("span",{class:"text-slate-500",children:"Version:"})," ",e("span",{class:"text-slate-200",children:t.version})]}),t.port>0&&e("span",{children:[e("span",{class:"text-slate-500",children:"Port:"})," ",e("span",{class:"text-slate-200",children:t.port})]}),t.channels!=null&&e("span",{children:[e("span",{class:"text-slate-500",children:"Channels:"})," ",e("span",{class:"text-slate-200",children:t.channels})]}),t.mail_enabled!=null&&e("span",{children:[e("span",{class:"text-slate-500",children:"Mail:"})," ",e("span",{class:"text-slate-200",children:t.mail_enabled?"Enabled":"Disabled"})]})]}),(t==null?void 0:t.running)&&!L&&(M||$||U)&&e("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[M&&e("div",{class:"bg-slate-800 rounded p-4",children:[e("h3",{class:"text-xs text-slate-400 uppercase tracking-wider mb-2",children:"Connections"}),e("div",{class:"space-y-1 text-sm",children:[e(R,{label:"Total",value:M.total}),e(R,{label:"TCP",value:M.tcp}),e(R,{label:"WebSocket",value:M.websocket}),e(R,{label:"Login Screen",value:M.login_screen}),e(R,{label:"Authenticated",value:M.connected})]})]}),$&&e("div",{class:"bg-slate-800 rounded p-4",children:[e("h3",{class:"text-xs text-slate-400 uppercase tracking-wider mb-2",children:"Command Queue"}),e("div",{class:"space-y-1 text-sm",children:[e(R,{label:"Immediate",value:$.immediate}),e(R,{label:"Waiting",value:$.waiting}),e(R,{label:"Semaphore",value:$.semaphore})]})]}),U&&e("div",{class:"bg-slate-800 rounded p-4",children:[e("h3",{class:"text-xs text-slate-400 uppercase tracking-wider mb-2",children:"Memory"}),e("div",{class:"space-y-1 text-sm",children:[e(R,{label:"Heap",value:`${(U.heap_alloc_mb??0).toFixed(1)} MB`}),e(R,{label:"Goroutines",value:U.goroutines})]})]})]}),a&&e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-3 mb-4 text-red-300 text-sm",children:[a,e("button",{onClick:()=>c(""),class:"ml-2 text-red-400 hover:text-red-300",children:"×"})]}),L&&e("div",{class:"bg-amber-500/10 border border-amber-500/30 rounded p-4 mb-4 text-amber-300 text-sm",children:"The server is in setup mode. Use the Setup wizard or Import page to create or import a game database, then launch the server."}),(t==null?void 0:t.running)&&!L&&e("div",{class:"bg-slate-800 rounded p-4 mb-4",children:[e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3",children:"How to Connect"}),e("div",{class:"space-y-2 text-sm",children:[e("div",{class:"flex items-start gap-3",children:[e("span",{class:"text-slate-500 w-24 shrink-0",children:"Telnet:"}),e("code",{class:"text-cyan-300 bg-slate-900 px-2 py-0.5 rounded",children:["telnet ",P," ",(t==null?void 0:t.port)||6886]})]}),e("div",{class:"flex items-start gap-3",children:[e("span",{class:"text-slate-500 w-24 shrink-0",children:"MU* Client:"}),e("span",{class:"text-slate-300",children:["Host: ",e("code",{class:"text-cyan-300 bg-slate-900 px-1 rounded",children:P})," Port: ",e("code",{class:"text-cyan-300 bg-slate-900 px-1 rounded",children:(t==null?void 0:t.port)||6886})]})]}),e("div",{class:"flex items-start gap-3",children:[e("span",{class:"text-slate-500 w-24 shrink-0",children:"Web Client:"}),e("a",{href:`http://${P}:8443/`,target:"_blank",class:"text-indigo-400 hover:text-indigo-300",children:["http://",P,":8443/"]})]}),e("div",{class:"mt-3 pt-3 border-t border-slate-700",children:[e("div",{class:"flex items-start gap-3",children:[e("span",{class:"text-slate-500 w-24 shrink-0",children:"God Login:"}),e("span",{class:"text-slate-300",children:e("code",{class:"text-cyan-300 bg-slate-900 px-1 rounded",children:"connect Wizard <password>"})})]}),e("p",{class:"text-slate-500 text-xs mt-1 ml-27",children:"Password is set via MUSH_GODPASS env variable. Change it in-game with: @password <old>=<new>"})]})]})]}),(h==null?void 0:h.active)&&e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-4 mb-4",children:[e("div",{class:"flex items-center justify-between mb-2",children:[e("h3",{class:"text-sm font-semibold text-red-300 uppercase tracking-wider",children:"Shutdown In Progress"}),e("button",{onClick:v,class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-xs transition-colors",children:"Cancel Shutdown"})]}),e("div",{class:"space-y-1 text-sm",children:[e("div",{children:[e("span",{class:"text-slate-500",children:"Reason:"})," ",e("span",{class:"text-slate-300",children:h.reason})]}),e("div",{children:[e("span",{class:"text-slate-500",children:"Stage:"})," ",e("span",{class:"text-slate-300",children:h.stage})]}),e("div",{children:[e("span",{class:"text-slate-500",children:"Time remaining:"})," ",e("span",{class:"text-red-300 font-mono text-lg",children:Fe(h.remaining)})]})]})]}),p&&e("div",{class:"bg-slate-800 border border-red-500/30 rounded p-4 mb-4",children:[e("h3",{class:"text-sm font-semibold text-red-300 mb-3",children:"Graceful Shutdown"}),e("p",{class:"text-xs text-slate-400 mb-3",children:"Players will receive @wall warnings before the server shuts down. A backup archive will be created automatically."}),e("div",{class:"space-y-3",children:[e("div",{children:[e("label",{class:"text-xs text-slate-400 block mb-1",children:"Delay"}),e("select",{value:m,onChange:E=>u(Number(E.target.value)),class:"w-full px-2 py-1.5 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 focus:outline-none focus:border-indigo-500",children:[e("option",{value:30,children:"30 seconds"}),e("option",{value:60,children:"1 minute"}),e("option",{value:120,children:"2 minutes"}),e("option",{value:300,children:"5 minutes (default)"}),e("option",{value:600,children:"10 minutes"}),e("option",{value:900,children:"15 minutes"})]})]}),e("div",{children:[e("label",{class:"text-xs text-slate-400 block mb-1",children:"Reason (optional)"}),e("input",{type:"text",placeholder:"Server maintenance",value:_,onInput:E=>C(E.target.value),class:"w-full px-2 py-1.5 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 focus:outline-none focus:border-indigo-500"})]}),e("div",{class:"flex gap-2 pt-1",children:[e("button",{onClick:D,class:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded text-sm transition-colors",children:"Begin Shutdown"}),e("button",{onClick:()=>o(!1),class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm transition-colors",children:"Cancel"})]})]})]}),e("div",{class:"flex gap-3",children:[t!=null&&t.running?!(h!=null&&h.active)&&!p?e("button",{onClick:()=>o(!0),class:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded text-sm transition-colors",children:"Shutdown Server"}):null:e("button",{onClick:w,disabled:L,class:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Start Server"}),e("button",{onClick:S,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm transition-colors",children:"Refresh"})]})]})}function X({label:t,value:s,color:n}){return e("div",{class:"bg-slate-800 rounded p-4",children:[e("div",{class:"text-xs text-slate-400 uppercase tracking-wider mb-1",children:t}),e("div",{class:`text-2xl font-bold ${n}`,children:s})]})}function R({label:t,value:s}){return e("div",{class:"flex justify-between",children:[e("span",{class:"text-slate-400",children:t}),e("span",{class:"text-slate-200",children:s})]})}function Fe(t){const s=Math.floor(t/86400),n=Math.floor(t%86400/3600),l=Math.floor(t%3600/60),i=Math.floor(t%60);return s>0?`${s}d ${n}h ${l}m`:n>0?`${n}h ${l}m ${i}s`:l>0?`${l}m ${i}s`:`${i}s`}const Me={0:"text-red-300 bg-red-950/50 border-red-500/30",1:"text-amber-200 bg-amber-950/40 border-amber-500/30",2:"text-blue-300 bg-blue-950/50 border-blue-500/30"},wt={0:"ERROR",1:"WARNING",2:"INFO"};function Ae({text:t,highlights:s,hlClass:n}){if(!s||s.length===0)return e(N,{children:t});const l=[];let i=0;for(const r of s)r.start>i&&l.push(e("span",{children:t.slice(i,r.start)},`t${i}`)),l.push(e("span",{class:n,children:t.slice(r.start,r.end)},`h${r.start}`)),i=r.end;return i<t.length&&l.push(e("span",{children:t.slice(i)},`t${i}`)),e(N,{children:l})}function St({finding:t,onFix:s}){const n=Me[t.severity]||Me[2];return e("div",{class:`border rounded p-3 mb-2 ${n}`,children:[e("div",{class:"flex items-start justify-between gap-2",children:[e("div",{class:"flex-1 min-w-0",children:[e("div",{class:"flex items-center gap-2 mb-1",children:[e("span",{class:"text-xs font-mono opacity-70",children:wt[t.severity]}),e("span",{class:"text-xs font-mono opacity-50",children:["#",t.object_ref]}),t.attr_name&&e("span",{class:"text-xs font-mono opacity-50",children:t.attr_name})]}),e("p",{class:"text-sm text-slate-200",children:t.description})]}),t.fixable&&!t.fixed&&s&&e("button",{onClick:()=>s(t.id),class:"px-2 py-1 bg-green-600 hover:bg-green-500 text-white text-xs rounded shrink-0 transition-colors",children:"Fix"}),t.fixed&&e("span",{class:"text-xs text-green-400 shrink-0",children:"Fixed"})]}),t.explanation&&e("div",{class:"mt-2 text-xs text-slate-400 bg-slate-800/40 rounded p-2 border-l-2 border-slate-600",children:t.explanation}),t.current&&e("div",{class:"mt-2",children:[e("div",{class:"text-xs text-slate-400 mb-0.5",children:"Current:"}),e("pre",{class:"text-xs font-mono bg-slate-900/60 text-slate-300 rounded p-1.5 overflow-x-auto whitespace-pre-wrap break-all",children:e(Ae,{text:t.current,highlights:t.current_hl,hlClass:"bg-red-500/30 text-red-200 rounded px-0.5"})})]}),t.proposed&&e("div",{class:"mt-1",children:[e("div",{class:"text-xs text-slate-400 mb-0.5",children:"Proposed:"}),e("pre",{class:"text-xs font-mono bg-slate-900/60 text-slate-300 rounded p-1.5 overflow-x-auto whitespace-pre-wrap break-all",children:e(Ae,{text:t.proposed,highlights:t.proposed_hl,hlClass:"bg-green-500/30 text-green-200 rounded px-0.5"})})]}),t.effect&&e("div",{class:"mt-1 text-xs text-slate-400",children:[e("span",{class:"text-slate-500",children:"Changes:"})," ",t.effect]})]})}const Ct={0:"Double-Escaped Brackets",1:"Attribute Flag Anomalies",2:"Escape Sequences",3:"Backslash-Percent Patterns",4:"Integrity Errors",5:"Integrity Warnings"},De={0:"C TinyMUSH processes queued commands with an extra evaluation pass. Code written for C used double-escaping (\\\\[text\\\\]) to compensate. GoTinyMUSH evaluates correctly, so these need to be simplified to single-escaping ([text]) to display properly.",1:"Some $-command attributes have patterns that could be confused with internal metadata formatting. GoTinyMUSH handles these correctly — these are informational only.",2:"Attributes containing raw ANSI escape codes (ESC bytes) for terminal colors and formatting. GoTinyMUSH supports these natively — no action needed.",3:"Similar to bracket escaping, backslash-percent patterns (\\\\%) were doubled for C's extra evaluation pass. The fix removes the extra backslash so percent-substitutions (%r, %t, %0-%9, etc.) work correctly.",4:"Objects referencing other objects (locations, parents, zones, links) that don't exist in the database. These may indicate objects that were destroyed without cleaning up references.",5:"Suspicious but non-critical reference issues, such as objects owned by non-player objects."},kt={0:"double-escape",1:"attr-flags",2:"escape-seq",3:"percent",4:"integrity-error",5:"integrity-warning"};function Tt({findings:t,onFix:s,onFixAll:n}){const l=new Map;for(const r of t){const a=l.get(r.category)||[];a.push(r),l.set(r.category,a)}const i=Array.from(l.keys()).sort();return e("div",{children:i.map(r=>{const a=l.get(r),c=a.filter(d=>d.fixable&&!d.fixed),h=a.filter(d=>d.fixed);return e("div",{class:"mb-6",children:[e("div",{class:"flex items-center justify-between mb-2",children:[e("h3",{class:"text-lg font-semibold text-slate-200",children:[Ct[r]||`Category ${r}`,e("span",{class:"text-sm font-normal text-slate-400 ml-2",children:["(",a.length," total",h.length>0?`, ${h.length} fixed`:"",")"]})]}),c.length>0&&n&&e("button",{onClick:()=>n(kt[r]),class:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-xs rounded transition-colors",children:["Fix All (",c.length,")"]})]}),De[r]&&e("div",{class:"text-xs text-slate-400 bg-slate-800/30 rounded p-2 mb-3 border-l-2 border-indigo-500/40",children:De[r]}),a.map(d=>e(St,{finding:d,onFix:s},d.id))]},r)})})}function Pt({tabs:t,children:s}){var i;const[n,l]=f(((i=t[0])==null?void 0:i.id)||"");return e("div",{children:[e("div",{class:"flex border-b border-slate-700 mb-4",children:t.map(r=>e("button",{onClick:()=>l(r.id),class:`px-4 py-2 text-sm transition-colors border-b-2 -mb-px ${n===r.id?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-300"}`,children:[r.label,r.badge!==void 0&&e("span",{class:"ml-1.5 px-1.5 py-0.5 text-xs bg-slate-700 rounded-full",children:r.badge})]},r.id))}),s(n)]})}function Lt({name:t,role:s,mode:n,initialContent:l,onSave:i}){const[r,a]=f(l||""),[c,h]=f(!1),[d,p]=f(!1),[o,m]=f(""),[u,_]=f(!l);q(()=>{!l&&n==="staged"&&(_(!0),y.importGetFile(s,t).then(b=>a(b.content||"")).catch(b=>m(b.message)).finally(()=>_(!1)))},[t,s]);const C=r.split(`
`).length,S=async()=>{h(!0),p(!1),m("");try{i?i(r):await y.importPutFile(s,t,r),p(!0),setTimeout(()=>p(!1),3e3)}catch(b){m(b.message)}finally{h(!1)}};return u?e("div",{class:"text-slate-400 text-sm",children:["Loading ",t,"..."]}):e("div",{class:"bg-slate-800 rounded p-4",children:[e("div",{class:"flex items-center justify-between mb-2",children:[e("div",{children:[e("span",{class:"text-sm font-mono text-slate-300",children:t}),e("span",{class:"ml-2 text-xs text-slate-500",children:[C," lines"]})]}),e("div",{class:"flex items-center gap-2",children:[d&&e("span",{class:"text-green-400 text-xs",children:"Saved!"}),o&&e("span",{class:"text-red-400 text-xs",children:o}),e("button",{onClick:S,disabled:c,class:"px-3 py-1 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-xs transition-colors disabled:opacity-50",children:c?"Saving...":"Save"})]})]}),e("textarea",{value:r,onInput:b=>a(b.target.value),class:"w-full h-64 px-3 py-2 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 font-mono resize-y focus:outline-none focus:border-indigo-500",spellcheck:!1})]})}function Et({name:t,initialContent:s,onSave:n}){const[l,i]=f(s||""),[r,a]=f(!1),[c,h]=f(!1),[d,p]=f(""),[o,m]=f(!s);q(()=>{s||(m(!0),y.importGetFile("alias_config",t).then(_=>i(_.content||"")).catch(_=>p(_.message)).finally(()=>m(!1)))},[t]);const u=async()=>{a(!0),h(!1),p("");try{n?n(l):await y.importPutFile("alias_config",t,l),h(!0),setTimeout(()=>h(!1),3e3)}catch(_){p(_.message)}finally{a(!1)}};return o?e("div",{class:"text-slate-400 text-sm",children:["Loading ",t,"..."]}):e("div",{class:"bg-slate-800 rounded p-4",children:[e("div",{class:"flex items-center justify-between mb-2",children:[e("div",{children:[e("span",{class:"text-sm font-mono text-slate-300",children:t}),e("span",{class:"ml-2 text-xs text-slate-500",children:"YAML alias config"})]}),e("div",{class:"flex items-center gap-2",children:[c&&e("span",{class:"text-green-400 text-xs",children:"Saved!"}),d&&e("span",{class:"text-red-400 text-xs",children:d}),e("button",{onClick:u,disabled:r,class:"px-3 py-1 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-xs transition-colors disabled:opacity-50",children:r?"Saving...":"Save"})]})]}),e("textarea",{value:l,onInput:_=>i(_.target.value),class:"w-full h-80 px-3 py-2 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 font-mono resize-y focus:outline-none focus:border-indigo-500",spellcheck:!1,placeholder:"# YAML alias configuration"})]})}function Xe({mode:t="live",stagedContent:s,onStagedSave:n}){const[l,i]=f(null),[r,a]=f(""),[c,h]=f(""),[d,p]=f(!1),[o,m]=f(!1),[u,_]=f(!1),[C,S]=f("");q(()=>{if(t==="staged"&&s){S(s);try{const v={};for(const L of s.split(`
`)){const P=L.match(/^(\w+):\s*(.*)$/);if(P){const[,M,$]=P;$==="true"?v[M]=!0:$==="false"?v[M]=!1:/^\d+$/.test($)?v[M]=parseInt($):$.startsWith('"')&&$.endsWith('"')?v[M]=$.slice(1,-1):v[M]=$}}Object.keys(v).length>0&&i(v)}catch{_(!0)}return}t==="live"&&y.getConfig().then(v=>{i(v.config),a(v.path)}).catch(v=>h(v.message))},[t,s]);const b=async()=>{p(!0),m(!1),h("");try{t==="staged"?n&&n(C):l&&await y.putConfig(l),m(!0),setTimeout(()=>m(!1),3e3)}catch(v){h(v.message)}finally{p(!1)}},w=(v,L)=>{i(P=>P?{...P,[v]:L}:null)};if(c&&!l&&!C)return e("div",{children:[e("h2",{class:"text-2xl font-bold mb-6",children:"Configuration"}),e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-4 text-red-300",children:c})]});if(!l&&!C)return e("div",{class:"text-slate-400",children:"Loading configuration..."});if(u||t==="staged")return e("div",{children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("div",{children:[e("h2",{class:"text-2xl font-bold",children:t==="staged"?"Config Preview":"Configuration"}),r&&e("p",{class:"text-xs text-slate-400 font-mono",children:r})]}),e("div",{class:"flex items-center gap-3",children:[l&&e("button",{onClick:()=>_(!u),class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded text-xs transition-colors",children:u?"Structured View":"Raw YAML"}),o&&e("span",{class:"text-green-400 text-sm",children:"Saved!"}),c&&e("span",{class:"text-red-400 text-sm",children:c}),e("button",{onClick:b,disabled:d,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:d?"Saving...":"Save"})]})]}),u||!l?e("textarea",{value:C,onInput:v=>S(v.target.value),class:"w-full h-96 px-3 py-2 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 font-mono resize-y focus:outline-none focus:border-indigo-500",spellcheck:!1}):$t(l,w)]});const D=tt(l);return e("div",{children:[e("div",{class:"flex items-center justify-between mb-6",children:[e("div",{children:[e("h2",{class:"text-2xl font-bold",children:"Configuration"}),e("p",{class:"text-xs text-slate-400 font-mono",children:r})]}),e("div",{class:"flex items-center gap-3",children:[e("button",{onClick:()=>{const v=Object.entries(l).map(([L,P])=>`${L}: ${JSON.stringify(P)}`).join(`
`);S(v),_(!0)},class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded text-xs transition-colors",children:"Raw YAML"}),o&&e("span",{class:"text-green-400 text-sm",children:"Saved!"}),c&&e("span",{class:"text-red-400 text-sm",children:c}),e("button",{onClick:b,disabled:d,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:d?"Saving...":"Save"})]})]}),D.map(([v,L])=>e("div",{class:"mb-6",children:[e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2",children:v}),e("div",{class:"bg-slate-800 rounded p-4 space-y-3",children:L.map(P=>e(et,{name:P,value:l[P],onChange:M=>w(P,M)},P))})]},v))]})}function $t(t,s){const n=tt(t);return e(N,{children:n.map(([l,i])=>e("div",{class:"mb-6",children:[e("h3",{class:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2",children:l}),e("div",{class:"bg-slate-800 rounded p-4 space-y-3",children:i.map(r=>e(et,{name:r,value:t[r],onChange:a=>s(r,a)},r))})]},l))})}function et({name:t,value:s,onChange:n}){const l=typeof s;return l==="boolean"?e("label",{class:"flex items-center gap-3 cursor-pointer",children:[e("input",{type:"checkbox",checked:s,onChange:i=>n(i.target.checked),class:"w-4 h-4 rounded border-slate-600 text-indigo-600 focus:ring-indigo-500"}),e("span",{class:"text-sm text-slate-300",children:t})]}):l==="number"?e("div",{class:"flex items-center gap-3",children:[e("label",{class:"text-sm text-slate-400 w-48 shrink-0",children:t}),e("input",{type:"number",value:s,onInput:i=>n(Number(i.target.value)),class:"flex-1 px-2 py-1 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 focus:outline-none focus:border-indigo-500"})]}):Array.isArray(s)?e("div",{class:"flex items-start gap-3",children:[e("label",{class:"text-sm text-slate-400 w-48 shrink-0 pt-1",children:t}),e("input",{type:"text",value:s.join(", "),onInput:i=>n(i.target.value.split(",").map(r=>r.trim()).filter(Boolean)),class:"flex-1 px-2 py-1 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 focus:outline-none focus:border-indigo-500",placeholder:"comma-separated values"})]}):e("div",{class:"flex items-center gap-3",children:[e("label",{class:"text-sm text-slate-400 w-48 shrink-0",children:t}),e("input",{type:"text",value:s??"",onInput:i=>n(i.target.value),class:"flex-1 px-2 py-1 bg-slate-900 border border-slate-600 rounded text-sm text-slate-200 focus:outline-none focus:border-indigo-500"})]})}function tt(t){const s={},n={mud_name:"Identity",port:"Identity",master_room:"Rooms",player_starting_room:"Rooms",player_starting_home:"Rooms",default_home:"Rooms",money_name_singular:"Economy",money_name_plural:"Economy",starting_money:"Economy",paycheck:"Economy",earn_limit:"Economy",page_cost:"Economy",wait_cost:"Economy",link_cost:"Economy",idle_timeout:"Idle",idle_wiz_dark:"Idle",queue_idle_chunk:"Queue",function_invocation_limit:"Queue",machine_command_cost:"Queue",output_limit:"Output",web_enabled:"Web",web_port:"Web",web_host:"Web",web_domain:"Web",web_static_dir:"Web",web_cors_origins:"Web",web_rate_limit:"Web",jwt_secret:"Web",jwt_expiry:"Web",guest_char_num:"Guests",guest_prefixes:"Guests",guest_suffixes:"Guests",guest_basename:"Guests",number_guests:"Guests",guest_password:"Guests",guest_start_room:"Guests",mail_enabled:"Modules",comsys_enabled:"Modules",mail_expiration:"Modules",spellcheck_enabled:"Modules",spellcheck_url:"Modules",pueblo_enabled:"Modules",pueblo_version:"Modules",sql_enabled:"SQL",sql_database:"SQL",sql_query_limit:"SQL",sql_timeout:"SQL",archive_dir:"Backup",archive_interval:"Backup",archive_retain:"Backup",archive_hook:"Backup"};for(const l of Object.keys(t)){const i=n[l]||"Other";s[i]||(s[i]=[]),s[i].push(l)}return Object.entries(s)}const Ie=["upload","discover","configure","summary","resolve","review","committed"],Ue={flatfile:"Flatfile",comsys:"Comsys DB",main_config:"Main Config",alias_config:"Alias Config",text:"Text File",dict:"Dictionary",discarded:"Discarded",unknown:"Unknown"},Ft=["flatfile","comsys","main_config","alias_config","text","dict","discarded","unknown"],Mt={high:"text-green-400",medium:"text-yellow-400",low:"text-red-400",manual:"text-blue-400"};function At(){const[t,s]=f("upload"),[n,l]=f(""),[i,r]=f(!1),[a,c]=f(null),[h,d]=f([]),[p,o]=f(null),[m,u]=f([]),[_,C]=f(""),[S,b]=f(null),[w,D]=f([]),[v,L]=f([]),P=async x=>{var H;const j=(H=x.target.files)==null?void 0:H[0];if(j){r(!0),l("");try{const I=await y.importUploadFile(j);if(c(I),I.source==="foreign_archive"||I.source==="gotinymush_archive"){s("discover");const V=await y.importDiscover();u(V.files||[])}else s("summary")}catch(I){l(I.message)}finally{r(!1)}}},M=async x=>{r(!0),l("");try{const g=await y.importUpload(x);if(c(g),g.source==="foreign_archive"||g.source==="gotinymush_archive"){s("discover");const j=await y.importDiscover();u(j.files||[])}else s("summary")}catch(g){l(g.message)}finally{r(!1)}},$=async(x,g)=>{try{await y.importAssign(x,g),u(j=>j.map(H=>H.path===x?{...H,role:g,confidence:"manual",reason:"manually assigned"}:H))}catch(j){l(j.message)}},U=async()=>{var x;r(!0),l("");try{const g=m.find(I=>I.role==="main_config");if(g)if(((x=g.path.split(".").pop())==null?void 0:x.toLowerCase())==="conf"){const V=await y.importConvertConfig(g.path);C(V.content||"")}else{const V=await y.importGetFile("main_config",g.path.split("/").pop()||"");C(V.content||"")}const j=m.find(I=>I.role==="comsys");if(j){const I=await y.importParseComsys(j.path);b({channels:I.channels||[],alias_count:I.alias_count||0})}const H=await y.importSession();D(H.text_files||[]),L(H.alias_files||[]),s("configure")}catch(g){l(g.message)}finally{r(!1)}},E=()=>{a!=null&&a.object_count||m.some(x=>x.role==="flatfile"),s("summary")},O=async()=>{var x;r(!0),l("");try{const g=await y.importValidate();d(((x=g.report)==null?void 0:x.findings)||[]),o(g.report),s("resolve")}catch(g){l(g.message)}finally{r(!1)}},W=async x=>{try{await y.importFix(x);const g=await y.importFindings();d(g.findings||[]),o(g)}catch(g){l(g.message)}},st=async x=>{try{await y.importFix(void 0,x);const g=await y.importFindings();d(g.findings||[]),o(g)}catch(g){l(g.message)}},[J,Y]=f(null),nt=async()=>{r(!0),l(""),Y({stage:"starting",detail:"Starting commit...",percent:0});const x=setInterval(async()=>{try{const g=await y.importCommitProgress();g.stage&&g.stage!=="idle"&&Y(g),g.stage==="error"&&(clearInterval(x),l(g.error||"Commit failed"),Y(null),r(!1))}catch{}},500);try{await y.importCommit(),clearInterval(x),Y(null),s("committed")}catch(g){clearInterval(x),Y(null),l(g.message)}finally{r(!1)}},rt=async()=>{try{await y.importReset(),s("upload"),c(null),u([]),C(""),b(null),D([]),L([]),d([]),o(null)}catch(x){l(x.message)}},lt=async()=>{try{const x=await y.importFindings();d(x.findings||[]),o(x)}catch(x){l(x.message)}},it=(a==null?void 0:a.source)==="flatfile"?Ie.filter(x=>x!=="discover"&&x!=="configure"):Ie;return e("div",{children:[e("div",{class:"flex items-center justify-between mb-6",children:[e("h2",{class:"text-2xl font-bold",children:"Import"}),t!=="upload"&&t!=="committed"&&e("button",{onClick:rt,class:"px-3 py-1 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded text-xs transition-colors",children:"Start Over"})]}),e("div",{class:"flex items-center gap-2 mb-6 text-sm flex-wrap",children:it.map((x,g)=>e("div",{class:"flex items-center gap-2",children:[g>0&&e("span",{class:"text-slate-600",children:"→"}),e("span",{class:t===x?"text-indigo-400 font-semibold":"text-slate-500",children:x.charAt(0).toUpperCase()+x.slice(1)})]},x))}),n&&e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-3 mb-4 text-red-300 text-sm",children:[n,e("button",{onClick:()=>l(""),class:"ml-2 text-red-400 hover:text-red-300",children:"×"})]}),t==="upload"&&e(Dt,{loading:i,onFileUpload:P,onPathUpload:M}),t==="discover"&&e(It,{files:m,loading:i,onReassign:$,onConfirm:U}),t==="configure"&&e(Ut,{configContent:_,comsysData:S,textFileNames:w,aliasFileNames:v,onConfigSave:x=>{C(x),y.importPutFile("main_config","config",x).catch(()=>{})},onDone:E}),t==="summary"&&a&&e(Ot,{result:a,loading:i,onValidate:O,hasExtraFiles:w.length>0||v.length>0||!!_}),t==="resolve"&&e("div",{children:[(p==null?void 0:p.categories)&&e("div",{class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:Object.entries(p.categories).map(([x,g])=>e("div",{class:"bg-slate-800 rounded p-3",children:[e("div",{class:"text-xs text-slate-400",children:g.label||x}),e("div",{class:"text-lg font-bold text-slate-200",children:g.total}),g.fixed>0&&e("div",{class:"text-xs text-green-400",children:[g.fixed," fixed"]})]},x))}),e(Tt,{findings:h,onFix:W,onFixAll:st}),e("div",{class:"flex gap-3 mt-4",children:[e("button",{onClick:()=>s("review"),class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors",children:"Review & Commit"}),e("button",{onClick:lt,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm transition-colors",children:"Refresh"})]})]}),t==="review"&&e("div",{children:[e("h3",{class:"text-lg font-semibold mb-3",children:"Review Changes"}),e("div",{class:"bg-slate-800 rounded p-4 mb-4",children:[e("p",{class:"text-sm text-slate-300",children:[h.filter(x=>x.fixed).length," fixes applied out of ",h.length," total findings."]}),e("p",{class:"text-sm text-slate-400 mt-1",children:[h.filter(x=>x.fixable&&!x.fixed).length," fixable findings remain unapplied."]}),(w.length>0||!!_)&&e("div",{class:"mt-3 pt-3 border-t border-slate-700",children:[e("p",{class:"text-sm text-slate-400",children:"Additional files staged for commit:"}),e("ul",{class:"text-sm text-slate-300 mt-1 list-disc ml-4",children:[_&&e("li",{children:"Game configuration (YAML)"}),w.length>0&&e("li",{children:[w.length," text file(s)"]}),v.length>0&&e("li",{children:[v.length," alias config(s)"]})]})]})]}),J&&e("div",{class:"bg-slate-800 rounded p-4 mb-4",children:[e("div",{class:"flex items-center gap-3 mb-2",children:[e("div",{class:"inline-block w-4 h-4 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-sm text-slate-200",children:J.detail})]}),e("div",{class:"w-full bg-slate-700 rounded-full h-2",children:e("div",{class:"bg-indigo-500 h-2 rounded-full transition-all duration-300",style:{width:`${J.percent}%`}})}),e("div",{class:"text-xs text-slate-500 mt-1",children:[J.percent,"%"]})]}),e("div",{class:"flex gap-3",children:[e("button",{onClick:nt,disabled:i,class:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:i?"Committing...":"Commit to Database"}),e("button",{onClick:()=>s("resolve"),disabled:i,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm transition-colors disabled:opacity-50",children:"Back to Resolve"})]})]}),t==="committed"&&e(jt,{})]})}function Dt({loading:t,onFileUpload:s,onPathUpload:n}){const[l,i]=f("");return e("div",{class:"max-w-lg",children:[e("div",{class:"bg-slate-800 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center mb-4",children:[e("p",{class:"text-slate-400 mb-3",children:"Upload a flatfile, archive (.tar.gz, .zip), or browse"}),e("input",{type:"file",accept:".flat,.FLAT,.gz,.tar.gz,.tgz,.zip",onChange:s,disabled:t,class:"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:bg-indigo-600 file:text-white hover:file:bg-indigo-500 file:cursor-pointer"})]}),e("div",{class:"text-slate-500 text-center text-sm mb-4",children:"or"}),e("div",{class:"flex gap-2",children:[e("input",{type:"text",placeholder:"Path to file or directory on server...",value:l,onInput:r=>i(r.target.value),class:"flex-1 px-3 py-2 bg-slate-800 border border-slate-600 rounded text-sm text-slate-200 focus:outline-none focus:border-indigo-500"}),e("button",{onClick:()=>l&&n(l),disabled:t||!l,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:t?"Loading...":"Load"})]})]})}function It({files:t,loading:s,onReassign:n,onConfirm:l}){const i=t.reduce((r,a)=>{const c=a.role;return r[c]=(r[c]||0)+1,r},{});return e("div",{children:[e("h3",{class:"text-lg font-semibold mb-3",children:"Discovered Files"}),e("p",{class:"text-sm text-slate-400 mb-4",children:["Found ",t.length," files. Review role assignments and adjust if needed."]}),e("div",{class:"flex flex-wrap gap-2 mb-4",children:Object.entries(i).map(([r,a])=>e("span",{class:"px-2 py-1 bg-slate-800 rounded text-xs text-slate-300",children:[Ue[r]||r,": ",a]},r))}),i.discarded>0&&e("div",{class:"bg-slate-800/50 border border-slate-700 rounded p-3 mb-4 text-sm text-slate-400",children:[i.discarded," file(s) marked as discarded (C TinyMUSH artifacts not needed by GoTinyMUSH). These will be skipped during import. Your original archive is unchanged."]}),e("div",{class:"bg-slate-800 rounded overflow-hidden mb-4",children:e("table",{class:"w-full text-sm",children:[e("thead",{children:e("tr",{class:"border-b border-slate-700",children:[e("th",{class:"text-left px-3 py-2 text-slate-400 font-medium",children:"File"}),e("th",{class:"text-left px-3 py-2 text-slate-400 font-medium w-40",children:"Role"}),e("th",{class:"text-center px-3 py-2 text-slate-400 font-medium w-16",children:"Conf."}),e("th",{class:"text-right px-3 py-2 text-slate-400 font-medium w-20",children:"Size"})]})}),e("tbody",{children:t.map(r=>e("tr",{class:`border-b border-slate-700/50 hover:bg-slate-750 ${r.role==="discarded"?"opacity-40":""}`,children:[e("td",{class:"px-3 py-2",children:[e("div",{class:`font-mono text-xs ${r.role==="discarded"?"text-slate-500 line-through":"text-slate-300"}`,children:r.path}),e("div",{class:"text-xs text-slate-500 mt-0.5",children:r.reason})]}),e("td",{class:"px-3 py-2",children:e("select",{value:r.role,onChange:a=>n(r.path,a.target.value),class:"w-full px-2 py-1 bg-slate-900 border border-slate-600 rounded text-xs text-slate-300 focus:outline-none focus:border-indigo-500",children:Ft.map(a=>e("option",{value:a,children:Ue[a]},a))})}),e("td",{class:"px-3 py-2 text-center",children:e("span",{class:`text-lg ${Mt[r.confidence]||"text-slate-500"}`,title:r.confidence,children:"●"})}),e("td",{class:"px-3 py-2 text-right text-slate-400 text-xs font-mono",children:Rt(r.size)})]},r.path))})]})}),e("button",{onClick:l,disabled:s,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:s?"Processing...":"Confirm & Continue"})]})}function Ut({configContent:t,comsysData:s,textFileNames:n,aliasFileNames:l,onConfigSave:i,onDone:r}){const a=[];return t&&a.push({id:"config",label:"Config"}),l.length>0&&a.push({id:"aliases",label:"Aliases",badge:l.length}),n.length>0&&a.push({id:"text",label:"Text Files",badge:n.length}),s&&a.push({id:"comsys",label:"Comsys"}),a.length===0?e("div",{children:[e("p",{class:"text-slate-400 mb-4",children:"No additional files to configure."}),e("button",{onClick:r,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors",children:"Continue to Summary"})]}):e("div",{children:[e("h3",{class:"text-lg font-semibold mb-3",children:"Configure Files"}),e("p",{class:"text-sm text-slate-400 mb-4",children:"Review and edit staged files before committing."}),e(Pt,{tabs:a,children:c=>e(N,{children:[c==="config"&&e(Xe,{mode:"staged",stagedContent:t,onStagedSave:i}),c==="aliases"&&e("div",{class:"space-y-4",children:l.map(h=>e(Et,{name:h},h))}),c==="text"&&e("div",{class:"space-y-4",children:n.map(h=>e(Lt,{name:h,role:"text",mode:"staged"},h))}),c==="comsys"&&s&&e("div",{class:"bg-slate-800 rounded p-4",children:[e("div",{class:"grid grid-cols-2 gap-4 mb-4",children:[e("div",{children:[e("span",{class:"text-xs text-slate-400",children:"Channels"}),e("div",{class:"text-lg font-bold text-slate-200",children:s.channels.length})]}),e("div",{children:[e("span",{class:"text-xs text-slate-400",children:"Player Aliases"}),e("div",{class:"text-lg font-bold text-slate-200",children:s.alias_count})]})]}),s.channels.length>0&&e("table",{class:"w-full text-sm",children:[e("thead",{children:e("tr",{class:"border-b border-slate-700",children:[e("th",{class:"text-left px-2 py-1 text-slate-400",children:"Channel"}),e("th",{class:"text-left px-2 py-1 text-slate-400",children:"Owner"}),e("th",{class:"text-left px-2 py-1 text-slate-400",children:"Description"}),e("th",{class:"text-right px-2 py-1 text-slate-400",children:"Messages"})]})}),e("tbody",{children:s.channels.map(h=>e("tr",{class:"border-b border-slate-700/50",children:[e("td",{class:"px-2 py-1 text-slate-300 font-mono",children:h.name}),e("td",{class:"px-2 py-1 text-slate-400",children:["#",h.owner]}),e("td",{class:"px-2 py-1 text-slate-400 truncate max-w-xs",children:h.description}),e("td",{class:"px-2 py-1 text-slate-400 text-right",children:h.num_sent})]},h.name))})]})]})]})}),e("div",{class:"mt-4",children:e("button",{onClick:r,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors",children:"Continue to Summary"})})]})}function Ot({result:t,loading:s,onValidate:n,hasExtraFiles:l}){return e("div",{children:[e("h3",{class:"text-lg font-semibold mb-3",children:"Import Summary"}),e("div",{class:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[e("div",{class:"bg-slate-800 rounded p-3",children:[e("div",{class:"text-xs text-slate-400",children:"Objects"}),e("div",{class:"text-xl font-bold text-slate-200",children:t.object_count??0})]}),e("div",{class:"bg-slate-800 rounded p-3",children:[e("div",{class:"text-xs text-slate-400",children:"Attr Definitions"}),e("div",{class:"text-xl font-bold text-slate-200",children:t.attr_defs??0})]}),e("div",{class:"bg-slate-800 rounded p-3",children:[e("div",{class:"text-xs text-slate-400",children:"Total Attributes"}),e("div",{class:"text-xl font-bold text-slate-200",children:t.total_attrs??0})]}),e("div",{class:"bg-slate-800 rounded p-3",children:[e("div",{class:"text-xs text-slate-400",children:"Source"}),e("div",{class:"text-sm font-mono text-slate-200 truncate",children:t.source||t.file})]})]}),t.type_counts&&e("div",{class:"bg-slate-800 rounded p-4 mb-4",children:[e("h4",{class:"text-sm text-slate-400 mb-2",children:"Object Types"}),e("div",{class:"grid grid-cols-3 md:grid-cols-6 gap-2",children:Object.entries(t.type_counts).map(([i,r])=>e("div",{children:[e("span",{class:"text-xs text-slate-500",children:[i,": "]}),e("span",{class:"text-sm text-slate-200",children:r})]},i))})]}),l&&e("div",{class:"bg-slate-800/50 rounded p-3 mb-4 text-sm text-slate-400",children:"Additional files (config, text, aliases) are staged and will be committed with the database."}),e("button",{onClick:n,disabled:s,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:s?"Validating...":"Run Validation"})]})}function jt(){const[t,s]=f(!1),[n,l]=f(""),i=async()=>{s(!0),l("");try{await y.serverLaunch()}catch{}let a=0;const c=setInterval(async()=>{a++;try{await y.serverStatus(),clearInterval(c),window.location.reload()}catch{a>30&&(clearInterval(c),l("Server did not come back after restart. Check Docker logs."),s(!1))}},2e3)};if(t)return e("div",{class:"text-center py-12",children:[e("div",{class:"inline-block w-8 h-8 border-4 border-indigo-400 border-t-transparent rounded-full animate-spin mb-4"}),e("h3",{class:"text-xl font-semibold mb-2",children:"Launching Server..."}),e("p",{class:"text-slate-400",children:"The server is restarting with your imported database."})]});const r=window.location.hostname;return e("div",{class:"text-center py-12",children:[e("div",{class:"text-4xl mb-4 text-green-400",children:"✓"}),e("h3",{class:"text-xl font-semibold mb-2",children:"Database Committed"}),e("p",{class:"text-slate-400 mb-6",children:"The database has been written to disk and is ready to go."}),n&&e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-3 mb-4 text-red-300 text-sm inline-block",children:n}),e("div",{class:"mb-6",children:e("button",{onClick:i,class:"px-6 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition-colors",children:"Launch Server"})}),e("div",{class:"bg-slate-800 rounded p-4 text-left max-w-md mx-auto text-sm",children:[e("h4",{class:"text-slate-400 text-xs uppercase tracking-wider mb-2",children:"After launch, connect via:"}),e("div",{class:"space-y-1",children:[e("div",{children:[e("span",{class:"text-slate-500",children:"Telnet:"})," ",e("code",{class:"text-cyan-300",children:["telnet ",r," 6886"]})]}),e("div",{children:[e("span",{class:"text-slate-500",children:"MU* Client:"})," ",e("span",{class:"text-slate-300",children:[r," port 6886"]})]}),e("div",{children:[e("span",{class:"text-slate-500",children:"God Login:"})," ",e("code",{class:"text-cyan-300",children:"connect Wizard <password>"})]}),e("p",{class:"text-slate-500 text-xs mt-2",children:"Password set via MUSH_GODPASS env variable."})]})]})]})}function Rt(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}function Nt({onComplete:t}){const[s,n]=f("welcome"),[l,i]=f(""),[r,a]=f(!1),[c,h]=f(!1),d=async()=>{a(!0),i("");try{await y.createNewDB(),h(!0),n("ready")}catch(u){i(u.message)}finally{a(!1)}},p=async()=>{n("launching"),i("");try{await y.serverLaunch(),setTimeout(()=>o(),2e3)}catch{setTimeout(()=>o(),2e3)}},o=()=>{let u=0;const _=setInterval(async()=>{u++;try{const C=await fetch("/health");C.ok&&(await C.json()).game_running&&(clearInterval(_),t())}catch{u>30&&(clearInterval(_),i("Server did not come back after restart. Check Docker logs."),n("ready"))}},2e3)},m=["welcome","config","database","ready"];return e("div",{class:"max-w-2xl mx-auto",children:[e("div",{class:"text-center mb-8",children:[e("h1",{class:"text-3xl font-bold text-indigo-400 mb-2",children:K.appName}),e("p",{class:"text-slate-400",children:"Setup Wizard"})]}),e("div",{class:"flex items-center justify-center gap-4 mb-8",children:m.map((u,_)=>e("div",{class:"flex items-center gap-2",children:[_>0&&e("div",{class:"w-8 h-px bg-slate-600"}),e("div",{class:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${s===u||s==="launching"&&u==="ready"?"bg-indigo-600 text-white":Oe(s)>_?"bg-green-600 text-white":"bg-slate-700 text-slate-400"}`,children:Oe(s)>_?"✓":_+1})]},u))}),l&&e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-3 mb-4 text-red-300 text-sm",children:[l,e("button",{onClick:()=>i(""),class:"ml-2 text-red-400 hover:text-red-300",children:"×"})]}),s==="welcome"&&e("div",{class:"bg-slate-800 rounded-lg p-8 text-center",children:[e("h2",{class:"text-xl font-semibold mb-4",children:["Welcome to ",K.appName]}),e("p",{class:"text-slate-400 mb-6",children:"This wizard will help you configure your MUSH server and set up your game database."}),e("button",{onClick:()=>n("config"),class:"px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded transition-colors",children:"Get Started"})]}),s==="config"&&e("div",{class:"bg-slate-800 rounded-lg p-8",children:[e("h2",{class:"text-xl font-semibold mb-4",children:"Configuration"}),e("p",{class:"text-slate-400 mb-4",children:"Your game configuration (game.yaml) contains server settings like port, name, and features. A default configuration will be created automatically. You can customize it later from the Config page."}),e("div",{class:"flex gap-3",children:[e("button",{onClick:()=>n("database"),class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors",children:"Continue"}),e("button",{onClick:()=>n("database"),class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm transition-colors",children:"Skip"})]})]}),s==="database"&&e("div",{class:"bg-slate-800 rounded-lg p-8",children:[e("h2",{class:"text-xl font-semibold mb-4",children:"Game Database"}),e("p",{class:"text-slate-400 mb-6",children:"Choose how to set up your game database:"}),e("div",{class:"space-y-3 mb-6",children:[e("button",{onClick:d,disabled:r,class:"w-full text-left p-4 bg-indigo-600/20 border border-indigo-500/40 rounded-lg hover:bg-indigo-600/30 transition-colors disabled:opacity-50",children:[e("div",{class:"text-indigo-300 font-semibold mb-1",children:r?"Creating...":"New Database (Recommended)"}),e("div",{class:"text-slate-400 text-sm",children:"Start fresh with an empty world. Creates Room Zero, Master Room, and the God (Wizard) player."})]}),e("button",{onClick:()=>{n("ready")},class:"w-full text-left p-4 bg-slate-700/50 border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors",children:[e("div",{class:"text-slate-200 font-semibold mb-1",children:"Import from Backup"}),e("div",{class:"text-slate-400 text-sm",children:"Upload a TinyMUSH flatfile (.FLAT) or archive (.tar.gz, .zip) with your existing game data. Use the Import page from the sidebar after setup."})]})]})]}),s==="ready"&&e("div",{class:"bg-slate-800 rounded-lg p-8",children:c?e(N,{children:[e("div",{class:"text-center",children:[e("div",{class:"text-4xl mb-4 text-green-400",children:"✓"}),e("h2",{class:"text-xl font-semibold mb-2",children:"Database Created"}),e("p",{class:"text-slate-400 mb-6",children:"Your new game world is ready with Room Zero, Master Room, and the Wizard player. Seed files (text, dict, config, aliases) have been copied to the data directory."})]}),e("div",{class:"bg-slate-900 rounded p-4 mb-6 text-sm",children:[e("h4",{class:"text-slate-400 text-xs uppercase tracking-wider mb-2",children:"After Launch"}),e("div",{class:"space-y-1 text-slate-300",children:[e("div",{children:[e("span",{class:"text-slate-500",children:"Telnet:"})," ",e("code",{class:"text-cyan-300",children:["telnet ",window.location.hostname," 6886"]})]}),e("div",{children:[e("span",{class:"text-slate-500",children:"MU* Client:"})," ",window.location.hostname," port 6886"]}),e("div",{children:[e("span",{class:"text-slate-500",children:"Web Client:"})," ",e("code",{class:"text-cyan-300",children:["http://",window.location.hostname,":8443/"]})]}),e("div",{class:"mt-2 pt-2 border-t border-slate-700",children:[e("span",{class:"text-slate-500",children:"God Login:"})," ",e("code",{class:"text-cyan-300",children:"connect Wizard <password>"})]}),e("p",{class:"text-slate-500 text-xs mt-1",children:["God password is set via MUSH_GODPASS in docker-compose.yml. Change it in-game: ",e("code",{children:"@password <old>=<new>"})]})]})]}),e("div",{class:"flex gap-3 justify-center",children:[e("button",{onClick:p,class:"px-6 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition-colors",children:"Launch Server"}),e("button",{onClick:t,class:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded text-sm transition-colors",children:"Go to Dashboard First"})]})]}):e(N,{children:e("div",{class:"text-center",children:[e("h2",{class:"text-xl font-semibold mb-4",children:"Setup Complete"}),e("p",{class:"text-slate-400 mb-6",children:"You can import a game database from the Import page, or create a new one. Use the sidebar to navigate to the Import page when ready."}),e("button",{onClick:t,class:"px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded transition-colors",children:"Go to Dashboard"})]})})}),s==="launching"&&e("div",{class:"bg-slate-800 rounded-lg p-8 text-center",children:[e("div",{class:"mb-4",children:e("div",{class:"inline-block w-8 h-8 border-4 border-indigo-400 border-t-transparent rounded-full animate-spin"})}),e("h2",{class:"text-xl font-semibold mb-4",children:"Launching Server..."}),e("p",{class:"text-slate-400",children:"The server is restarting with your new database. This may take a few seconds."})]})]})}function Oe(t){return["welcome","config","database","ready"].indexOf(t)}function Ht({onLogin:t}){const[s,n]=f(""),[l,i]=f(""),[r,a]=f(!1),c=async h=>{h.preventDefault(),a(!0),i("");try{const d=await y.authLogin(s);t(d.default_password)}catch(d){i(d.message||"Login failed")}finally{a(!1)}};return e("div",{class:"min-h-screen flex items-center justify-center bg-slate-900",children:e("div",{class:"bg-slate-800 rounded-lg p-8 w-full max-w-sm",children:[e("div",{class:"text-center mb-6",children:[e("h1",{class:"text-2xl font-bold text-indigo-400",children:K.appName}),e("p",{class:"text-sm text-slate-400 mt-1",children:"Admin Panel"})]}),e("form",{onSubmit:c,children:[e("div",{class:"mb-4",children:[e("label",{class:"block text-sm text-slate-400 mb-1",children:"Password"}),e("input",{type:"password",value:s,onInput:h=>n(h.target.value),class:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded text-slate-200 focus:outline-none focus:border-indigo-500",placeholder:"Enter admin password",autoFocus:!0})]}),l&&e("div",{class:"bg-red-500/10 border border-red-500/30 rounded p-2 mb-4 text-red-300 text-sm",children:l}),e("button",{type:"submit",disabled:r||!s,class:"w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-sm transition-colors disabled:opacity-50",children:r?"Logging in...":"Login"})]}),e("p",{class:"text-xs text-slate-500 text-center mt-4",children:"Default password: goTinyMush"})]})})}function Gt(){const[t,s]=f("dashboard"),[n,l]=f(!1),[i,r]=f(null),[a,c]=f(!1);q(()=>{yt(()=>r(!1)),y.authStatus().then(o=>{r(o.authenticated),o.authenticated&&o.default_password&&c(!0)}).catch(()=>r(!1))},[]),q(()=>{i&&y.setupStatus().then(o=>{o.setup_mode&&(l(!0),s("setup"))}).catch(()=>{})},[i]);const h=o=>{r(!0),o&&c(!0)},d=async()=>{await y.authLogout().catch(()=>{}),r(!1)};return i===null?e("div",{class:"min-h-screen flex items-center justify-center bg-slate-900 text-slate-400",children:"Loading..."}):i?e(vt,{currentPage:t,onNavigate:s,setupMode:n,onLogout:d,children:[a&&e("div",{class:"bg-amber-500/10 border border-amber-500/30 rounded p-3 mb-4 text-amber-300 text-sm flex items-center justify-between",children:[e("span",{children:"You are using the default admin password. Change it in the admin settings for security."}),e("button",{onClick:()=>c(!1),class:"text-amber-400 hover:text-amber-300 ml-2",children:"×"})]}),(()=>{switch(t){case"dashboard":return e($e,{});case"import":return e(At,{});case"config":return e(Xe,{});case"setup":return e(Nt,{onComplete:()=>{l(!1),s("dashboard")}});default:return e($e,{})}})()]}):e(Ht,{onLogin:h})}pt(e(Gt,{}),document.getElementById("app"));
